---
title: "Lab 09: Logistic Regression"
subtitle: "Due: Thu, Apr 15 at 11:59pm ET"
author: "Navya Belavadi"
date: "04-16-2021"
editor_options: 
  chunk_output_type: console
output:
  pdf_document: default
---

```{r set_up, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE,
                      comment = "#>", highlight = TRUE,
                      fig.align = "center")
```

## Packages

```{r echo=TRUE}
library(tidyverse)
library(broom)
```

## Data

```{r data}
retirement <- read_csv("data/retirement_data.csv")
```

The 2018 election saw a near-record number of [retirements](https://www.pewresearch.org/fact-tank/2018/04/11/near-record-number-of-house-members-not-seeking-re-election-in-2018/) from Congress. In this lab, you will be working with data from that election.

The variables in this dataset are:

- `stcd`: an ID number for the congressional district. Districts are listed in 
          alphabetic order (e.g., 101 is Alabama's first district).

- `dpres`: the two-party percentage of vote received by Hillary Clinton 
           in the district in 2016. (Third party vote has been eliminated here, 
           this represents Democratic vote/ (Democratic + Republican Vote).)

- `retiring`: a dummy variable indicating whether the representative retired in 
              2018. The includes both representatives who left politics 
              altogether and those who sought higher office, as well as some 
              who resigned early.

- `gopseat`: a dummy variable indicating whether the seat was held by a 
             Republican.

- `age`: he age of the representative at the end of 2018.

# Exercises

## Exercise 1
```{r}
new_retirement <- retirement %>%
  group_by(gopseat) %>%
  mutate(dpres = case_when(gopseat == 0 ~ dpres, gopseat == 1 ~ 100-depres), gopseat = ifelse(gopseat == 0, "Democrat", "Republican")) %>%
  filter(!is.na(gopseat) | !is.na(age) | !is.na(retiring))
```

```{r}
log_mod <- glm(retiring ~ dpres + factor(gopseat) + age, data = new_retirement, family = "binomial")
tidy(log_mod)
```

## Exercise 2
```{r}
tidy(log_mod) %>%
  mutate(estimate_odds = exp(estimate)) %>%
  select(term, estimate, estimate_odds)
```


## Exercise 3
```{r}
tibble(
  dpres = rep(33:96, times = 2),
  gopseat = factor(rep(c("Democrat", "Republican"), each = 64)),
  age = 59.42) %>%
  augment(log_mod, newdata = .) %>%
  mutate(log_mod, newdata = .) %>%
  ggplot(aes(x = dpres, y = predicted_p, color = gopseat)) +
  geom_line(size = 1.5) +
  theme_minimal(base_size = 14) +
  scale_color_manual(values = c("blue", "red")) +
  labs(title = "Graph of Predicted Probability Values vs. Percentage of Vote", subtitle = "Colored by Political Party", x = "Percentage of Vote Received", y = "Predicted Probability", color = "Political Party")
```

## Exercise 4
```{r}
tibble(
  age = 78,
  gopseat = factor("Democrat"),
  dpres = 70.75) %>%
  augment(log_mod, newdata = .) %>%
    mutate(p = exp(.fitted) / (1 + exp(.fitted))) %>%
    pull(p)
```

## Exercise 5
