---
title: "Lab 09: Logistic Regression"
subtitle: "Due: Thu, Apr 15 at 11:59pm ET"
author: "Navya Belavadi"
date: "04-16-2021"
editor_options: 
  chunk_output_type: console
output:
  pdf_document: default
---

```{r set_up, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE,
                      comment = "#>", highlight = TRUE,
                      fig.align = "center")
```

## Packages

```{r echo=TRUE}
library(tidyverse)
library(broom)
```

## Data

```{r data}
retirement <- read_csv("data/retirement_data.csv")
```

The 2018 election saw a near-record number of [retirements](https://www.pewresearch.org/fact-tank/2018/04/11/near-record-number-of-house-members-not-seeking-re-election-in-2018/) from Congress. In this lab, you will be working with data from that election.

The variables in this dataset are:

- `stcd`: an ID number for the congressional district. Districts are listed in 
          alphabetic order (e.g., 101 is Alabama's first district).

- `dpres`: the two-party percentage of vote received by Hillary Clinton 
           in the district in 2016. (Third party vote has been eliminated here, 
           this represents Democratic vote/ (Democratic + Republican Vote).)

- `retiring`: a dummy variable indicating whether the representative retired in 
              2018. The includes both representatives who left politics 
              altogether and those who sought higher office, as well as some 
              who resigned early.

- `gopseat`: a dummy variable indicating whether the seat was held by a 
             Republican.

- `age`: he age of the representative at the end of 2018.

# Exercises

## Exercise 1
```{r ex1.1}
new_retirement <- retirement %>%
  group_by(gopseat) %>%
  mutate(dpres = case_when(gopseat == 0 ~ dpres, gopseat == 1 ~ 100-depres), 
         gopseat = ifelse(gopseat == 0, "Democrat", "Republican")) %>%
  filter(!is.na(gopseat) | !is.na(age) | !is.na(retiring))
```

```{r ex1.2}
log_mod <- glm(retiring ~ dpres + factor(gopseat) + age, data = new_retirement, 
               family = "binomial")
tidy(log_mod)
```

log(p/(1-p)) = 0.0231 + 0.0130age - 0.0487dpres + 0.507gopseat 

## Exercise 2
```{r ex2}
tidy(log_mod) %>%
  mutate(estimate_odds = exp(estimate)) %>%
  select(term, estimate, estimate_odds)
```

Age: Age of the candidate; When holding dpres and gopseat constant, for each 
year in age the odds of retirement can be expected to multiply by e^-0.0130, or
1.01. 

dpres: The percentage of vote received by the presidential candidate for the 
party which holds that Congressional seat; When holding gopseat and age 
constant, for each increase in the percentage of vote received by the 
presidential candidate by 1% for the party in Congress, the probability of 
retirement on average multiplies by e^-0.0487, or 0.952. 

Gopseat: Whether the seat is held by a Republican or not; When holding dpres and
age constant, the odds of retirement for Republican Congressional seat holders 
is e^-0.507, or 1.66 times the odds of retirement for Democrat Congressional 
seat holders. If dpres and age are in the 0th percentile and the Congressional 
seat is not held by a Republican candidate, the odds of retiring are e^-0.0231, 
or 1.02.  

## Exercise 3
```{r ex3}
tibble(
  dpres = rep(33:96, times = 2),
  gopseat = factor(rep(c("Democrat", "Republican"), each = 64)),
  age = 59.42) %>%
  augment(log_mod, newdata = .) %>%
  mutate(log_mod, newdata = .) %>%
  ggplot(aes(x = dpres, y = predicted_p, color = gopseat)) +
  geom_line(size = 1.5) +
  theme_minimal(base_size = 14) +
  scale_color_manual(values = c("blue", "red")) +
  labs(title = "Predicted Retirement Probability vs. Percentage of Vote", 
       subtitle = "Colored by Political Party", x = "Percentage of Vote 
       Received", y = "Predicted Probability of Retirement", color = "Political 
       Party")
```
It can be observed from this graph that as the percentage of vote received 
increases for each of the political parties (Democrat and Republican), the 
predicted probability of retirement decreases. This relationship appears to be 
stronger for the Republican party than the Democratic party, as the curve of 
best fit for Republicans decreases at a more rapid rate than that of the 
Democrats. Therefore, the percentage of vote received increasing had a larger 
effect on the Republican party than the Democratic party. 

## Exercise 4
```{r ex4}
tibble(
  age = 78,
  gopseat = factor("Democrat"),
  dpres = 70.75) %>%
  augment(log_mod, newdata = .) %>%
    mutate(p = exp(.fitted) / (1 + exp(.fitted))) %>%
    pull(p)
```
According to this logistic model, the probability that Price would retire in 
2018 would be 0.0825, or around 8.25%. 

## Exercise 5
```{r ex5.1}
retirement_probs <- augment(log_mod, newdata = new_retirement) %>%
  mutate(p = exp(.fitted) / (1 + exp(.fitted))) %>%
  arrange(desc(p))
retirement_probs
```

```{r ex5.2}
retirement_probs %>% slice(1)
```

No member of Congress had over a 50% chance of retiring in 2018. The highest 
probability of retirement belongs to Pennsylvania's 5th district's 
representative from District 3805, which was at a 40.70% chance. Since the 
retirement variable is 1, the member retired from Congress. 
